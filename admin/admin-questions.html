<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Manage Questions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #1f2937;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
    }

    /* Sidebar Styles */
    .sidebar {
      width: 280px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      color: #1f2937;
      min-height: 100vh;
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.1);
      border-right: 1px solid rgba(255, 255, 255, 0.2);
    }

    .sidebar-header {
      text-align: center;
      margin-bottom: 3rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .sidebar-header h2 {
      font-size: 1.8rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
    }

    .sidebar-header p {
      font-size: 0.9rem;
      color: #6b7280;
      font-weight: 500;
    }

    .nav-section {
      margin-bottom: 2rem;
    }

    .nav-section-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
      padding-left: 0.5rem;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.875rem 1rem;
      border-radius: 12px;
      color: #374151;
      font-weight: 500;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      text-decoration: none;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .nav-link::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s ease;
      z-index: 0;
    }

    .nav-link:hover::before,
    .nav-link.active::before {
      width: 100%;
    }

    .nav-link:hover,
    .nav-link.active {
      color: white;
      transform: translateX(4px);
    }

    .nav-link i {
      z-index: 1;
      position: relative;
      font-size: 1.1rem;
    }

    .nav-link span {
      z-index: 1;
      position: relative;
    }

    .nav-link.active {
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 2rem;
      border-top: 1px solid #e5e7eb;
    }

    .admin-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background: #f8fafc;
      border-radius: 12px;
      margin-bottom: 1rem;
    }

    .admin-avatar {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1rem;
    }

    .admin-details h4 {
      font-size: 0.9rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.25rem;
    }

    .admin-details p {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .logout-btn {
      width: 100%;
      padding: 0.75rem 1rem;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }

    /* Main Content */
    .main {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 2.5rem;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    h1 {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .filters {
      display: flex;
      gap: 1.5rem;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      background: #f8fafc;
      padding: 1.5rem;
      border-radius: 16px;
      border: 1px solid #e5e7eb;
    }

    .filters label {
      font-weight: 500;
      color: #374151;
    }

    .filters input, .filters select {
      padding: 0.5rem 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 1rem;
      background: white;
      margin-left: 0.4rem;
      transition: border-color 0.3s ease;
    }

    .filters input:focus, .filters select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .filters button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .filters button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .filters button.create-btn {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .filters button.create-btn:hover {
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
    }

    .filters button.upload-btn {
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    }

    .filters button.upload-btn:hover {
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
    }

    .filters button.download-btn {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .filters button.download-btn:hover {
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
    }

    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }

    th, td {
      border-bottom: 1px solid #f3f4f6;
      padding: 1rem 0.75rem;
      text-align: left;
      font-size: 1rem;
    }

    th {
      background: #f8fafc;
      font-weight: 600;
      color: #374151;
      letter-spacing: 0.5px;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover {
      background: #f9fafb;
    }

    td.actions {
      min-width: 120px;
    }

    .action-btn {
      background: none;
      border: none;
      color: #667eea;
      font-size: 1.1rem;
      margin: 0 0.3rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 8px;
      padding: 0.5rem;
    }

    .action-btn:hover {
      background: #f3f4f6;
      color: #4f46e5;
      transform: translateY(-1px);
    }

    .action-btn.delete:hover {
      background: #fef2f2;
      color: #dc2626;
    }

    .modal-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal {
      background: white;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      padding: 2.5rem;
      min-width: 400px;
      max-width: 95vw;
      position: relative;
      animation: popIn 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
    }

    @keyframes popIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .modal h3 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .modal label {
      display: block;
      margin-bottom: 0.5rem;
      color: #374151;
      font-weight: 500;
      position: relative;
    }

    .required-star {
      color: #ef4444;
      margin-left: 2px;
      font-size: 1.1em;
      font-weight: bold;
    }

    .modal input, .modal select, .modal textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 1rem;
      background: #f9fafb;
      margin-bottom: 1rem;
      transition: border-color 0.3s ease;
    }

    .modal input:focus, .modal select:focus, .modal textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .modal .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
    }

    .modal .modal-actions button {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal .modal-actions .save {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .modal .modal-actions .save:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .modal .modal-actions .cancel {
      background: #f3f4f6;
      color: #374151;
    }

    .modal .modal-actions .cancel:hover {
      background: #e5e7eb;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .sidebar {
        width: 240px;
        padding: 1.5rem 1rem;
      }
      
      .main {
        padding: 1.5rem;
      }
    }

    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        min-height: auto;
        padding: 1rem;
      }
      
      .sidebar-header {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
      }
      
      .nav-section {
        margin-bottom: 1rem;
      }
      
      .main {
        padding: 1rem;
      }
      
      .container {
        padding: 1.5rem;
      }
      
      .filters {
        flex-direction: column;
        align-items: stretch;
      }
      
      .filters > * {
        margin-bottom: 0.5rem;
      }
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container {
      animation: fadeInUp 0.6s ease forwards;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2>
        <i class="fas fa-cogs"></i>
        Admin Panel
      </h2>
      <p>Exam Prep Platform</p>
    </div>

    <nav class="nav-section">
      <div class="nav-section-title">Main Navigation</div>
      <a href="dashboard.html" class="nav-link">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </a>
      <a href="admin-questions.html" class="nav-link active">
        <i class="fas fa-question"></i>
        <span>Questions</span>
      </a>
      <a href="topics.html" class="nav-link">
        <i class="fas fa-tags"></i>
        <span>Topics</span>
      </a>
      <a href="mock.html" class="nav-link">
        <i class="fas fa-list-ol"></i>
        <span>Mock Tests</span>
      </a>
      <a href="user.html" class="nav-link">
        <i class="fas fa-users"></i>
        <span>Users</span>
      </a>
    </nav>

    <nav class="nav-section">
      <div class="nav-section-title">Management</div>
      <a href="#" class="nav-link">
        <i class="fas fa-bell"></i>
        <span>Notifications</span>
      </a>
      <a href="#" class="nav-link">
        <i class="fas fa-chart-bar"></i>
        <span>Analytics</span>
      </a>
      <a href="#" class="nav-link">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="admin-info">
        <div class="admin-avatar">A</div>
        <div class="admin-details">
          <h4>Admin User</h4>
          <p>Super Administrator</p>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i>
        Logout
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <div class="container">
      <h1><i class="fas fa-question"></i> Manage Questions</h1>
      <div id="adminMsg" style="margin-bottom:1rem;min-height:28px;font-weight:600;"></div>
      <div class="filters">
        <label>Exam: <input id="exam" value="CAT"></label>
        <label>Day: <input id="day" type="number" value="1"></label>
        <label>Type: 
          <select id="type">
            <option value="">All</option>
            <option value="mock">Mock</option>
            <option value="practice">Practice</option>
          </select>
        </label>
        <button onclick="fetchQuestions()"><i class="fas fa-search"></i> Fetch Questions</button>
        <button onclick="showCreateModal()" class="create-btn"><i class="fas fa-plus"></i> Create New Question</button>
        <label style="display:flex;align-items:center;gap:0.5rem;">
          <input type="file" id="csvFileInput" accept=".csv" style="display:none;" onchange="handleCSVSelected(event)">
          <button type="button" onclick="document.getElementById('csvFileInput').click()" class="upload-btn"><i class="fas fa-upload"></i> Bulk Upload (CSV)</button>
        </label>
        <div id="csvPreviewContainer" style="margin-top:1em;"></div>
        <div id="csvConfirmContainer" style="margin-top:0.5em;"></div>
        <!-- Improved CSV columns info -->
        <style>
          #csvColumnsInfoBox {
            margin: 0.7em 0 0.5em 0;
            padding: 0.7em 1em;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            max-width: 900px;
            min-width: 0;
            font-size: 0.97em;
            margin-left: auto;
            margin-right: auto;
            box-sizing: border-box;
          }
          #csvColumnsInfoBox .csv-cols-grid {
            display: grid;
            grid-template-columns: 1fr 1px 1fr 1px 1fr;
            gap: 0.5em 1.5em;
            align-items: start;
          }
          #csvColumnsInfoBox .csv-cols-divider {
            background: #e5e7eb;
            width: 1px;
            min-height: 100px;
            height: 100%;
            margin: 0 0.5em;
          }
          #csvColumnsInfoBox ul {
            margin: 0.2em 0 0 1.1em;
            padding: 0;
            list-style: disc;
          }
          #csvColumnsInfoBox li {
            margin-bottom: 0.18em;
            line-height: 1.45;
            font-size: 0.97em;
          }
          #csvColumnsInfoBox .csv-cols-section {
            margin-bottom: 0.5em;
          }
          #csvColumnsInfoBox .csv-cols-section-title {
            font-weight: 600;
            margin-bottom: 0.2em;
          }
          #csvColumnsInfoBox .csv-cols-required { color: #059669; }
          #csvColumnsInfoBox .csv-cols-mock { color: #7c3aed; }
          #csvColumnsInfoBox .csv-cols-optional { color: #6b7280; }
          #csvColumnsInfoBox .csv-cols-mock span { color: #6366f1; }
          @media (max-width: 900px) {
            #csvColumnsInfoBox .csv-cols-grid {
              grid-template-columns: 1fr 1px 1fr;
            }
            #csvColumnsInfoBox .csv-cols-divider:nth-child(2) { display: none; }
          }
          @media (max-width: 700px) {
            #csvColumnsInfoBox .csv-cols-grid {
              grid-template-columns: 1fr;
            }
            #csvColumnsInfoBox .csv-cols-divider { display: none; }
          }
        </style>
        <div id="csvColumnsInfoBox">
          <div style="font-weight:600;margin-bottom:0.3em;">CSV Columns:</div>
          <div class="csv-cols-grid">
            <div>
              <div class="csv-cols-section csv-cols-section-title csv-cols-required">Required for all questions:</div>
              <ul>
                <li><b>id</b> – Unique question ID</li>
                <li><b>question</b> – The question text</li>
                <li><b>option1</b>, <b>option2</b>, <b>option3</b>, <b>option4</b> – Four answer options</li>
                <li><b>answerIndex</b> – Correct option (0-based: 0,1,2,3)</li>
                <li><b>type</b> – <span style='color:#6366f1'>mock</span> or <span style='color:#6366f1'>practice</span></li>
                <li><b>topics</b> – Comma-separated topic names</li>
                <li><b>level</b> – e.g. Easy, Medium, Hard</li>
              </ul>
            </div>
            <div class="csv-cols-divider"></div>
            <div>
              <div class="csv-cols-section csv-cols-section-title csv-cols-mock">Required for <span>mock</span> questions:</div>
              <ul>
                <li><b>mock_code</b> – Code of the mock test to assign this question to</li>
                <li><b>day</b> – Day number</li>
                <li><b>section</b> – Section name</li>
              </ul>
            </div>
            <div class="csv-cols-divider"></div>
            <div>
              <div class="csv-cols-section csv-cols-section-title csv-cols-optional">Optional:</div>
              <ul>
                <li><b>explanation</b> – Solution or explanation</li>
                <li><b>chapter</b> – Chapter name</li>
                <li><b>exam</b> – Exam code/name</li>
                <li><b>difficulty</b> – e.g. Medium, Hard</li>
              </ul>
            </div>
          </div>
        </div>
        <button type="button" onclick="downloadQuestionsCSV()" class="download-btn"><i class="fas fa-download"></i> Download All as CSV</button>
        <button type="button" onclick="downloadTemplateCSV()" class="download-btn"><i class="fas fa-file-csv"></i> Download Template CSV</button>
      </div>
      <table id="questionsTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Question</th>
            <th>Section</th>
            <th>Type</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <!-- Edit Modal -->
  <div id="editModalBg" class="modal-bg" style="display:none;">
    <div class="modal">
      <h3><i class="fas fa-edit"></i> Edit Question</h3>
      <form id="editForm">
        <label>Exam<span class="required-star">*</span>: <input id="editExam" required style="width: 160px;"></label>
        <label id="labelEditDay">Day<span class="required-star" id="starEditDay">*</span>: <input id="editDay" type="number" style="width: 100px;"></label>
        <label id="labelEditSection">Section<span class="required-star" id="starEditSection">*</span>: <input id="editSection" style="width: 160px;"></label>
        <label>ID<span class="required-star">*</span>: <input id="editId" required style="width: 160px;" readonly></label>
        <label>Image URL: <input id="editImg" style="width: 220px;"></label>
        <label>Passage: <textarea id="editPassage" rows="4" style="width: 98%; min-width: 350px; min-height: 60px;"></textarea></label>
        <label>Question<span class="required-star">*</span>: <textarea id="editQuestion" required rows="4" style="width: 98%; min-width: 350px; min-height: 60px;"></textarea></label>
        <label>Options<span class="required-star">*</span>:</label>
        <div style="display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap;">
          <input id="editOption0" required placeholder="Option 1" style="flex:1 1 220px; min-width:180px; padding:0.7rem; font-size:1.1em;">
          <input id="editOption1" required placeholder="Option 2" style="flex:1 1 220px; min-width:180px; padding:0.7rem; font-size:1.1em;">
          <input id="editOption2" required placeholder="Option 3" style="flex:1 1 220px; min-width:180px; padding:0.7rem; font-size:1.1em;">
          <input id="editOption3" required placeholder="Option 4" style="flex:1 1 220px; min-width:180px; padding:0.7rem; font-size:1.1em;">
        </div>
        <label>Answer Index<span class="required-star">*</span> (0-3): <input id="editAnswerIndex" type="number" min="0" max="3" required style="width: 100px;"></label>
        <label>Explanation: <textarea id="editExplanation" rows="3" style="width: 98%; min-width: 350px; min-height: 50px;"></textarea></label>
        <label>Video: <input id="editVideo" style="width: 220px;"></label>
        <label>Video URL: <input id="editVideoUrl" style="width: 220px;"></label>
        <label>Video Start (seconds): <input id="editVideoStart" type="number" min="0" style="width: 120px;"></label>
        <label>Type<span class="required-star">*</span>: 
          <select id="editType" required style="width: 120px;" onchange="updateEditMockFieldsRequired()">
            <option value="mock">Mock</option>
            <option value="practice">Practice</option>
          </select>
        </label>
        <div class="modal-actions">
          <button type="submit" class="save" id="editSubmitBtn"><span id="editSpinner" style="display:none;"><i class='fas fa-spinner fa-spin'></i></span> <i class="fas fa-save"></i> Save</button>
          <button type="button" class="cancel" onclick="closeEditModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Modal -->
  <div id="createModalBg" class="modal-bg" style="display:none;">
    <div class="modal">
      <h3><i class="fas fa-plus"></i> Create New Question</h3>
      <form id="createForm">
        <label>Exam<span class="required-star">*</span>: <input id="createExam" required style="width: 160px;"></label>
        <label id="labelCreateDay">Day<span class="required-star" id="starCreateDay">*</span>: <input id="createDay" type="number" style="width: 100px;"></label>
        <label id="labelCreateSection">Section<span class="required-star" id="starCreateSection">*</span>: <input id="createSection" style="width: 160px;"></label>
        <label>ID<span class="required-star">*</span>: <input id="createId" required style="width: 160px;"></label>
        <label>Image URL: <input id="createImg" style="width: 220px;"></label>
        <label>Passage: <textarea id="createPassage" rows="4" style="width: 98%; min-width: 350px; min-height: 60px;"></textarea></label>
        <label>Question<span class="required-star">*</span>: <textarea id="createQuestion" required rows="4" style="width: 98%; min-width: 350px; min-height: 60px;"></textarea></label>
        <label>Options<span class="required-star">*</span>:</label>
        <div style="display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap;">
          <input id="createOption0" required placeholder="Option 1" style="flex:1 1 220px; min-width:180px; padding:0.7rem; font-size:1.1em;">
          <input id="createOption1" required placeholder="Option 2" style="flex:1 1 220px; min-width:180px; padding:0.7rem; font-size:1.1em;">
          <input id="createOption2" required placeholder="Option 3" style="flex:1 1 220px; min-width:180px; padding:0.7rem; font-size:1.1em;">
          <input id="createOption3" required placeholder="Option 4" style="flex:1 1 220px; min-width:180px; padding:0.7rem; font-size:1.1em;">
        </div>
        <label>Answer Index<span class="required-star">*</span> (0-3): <input id="createAnswerIndex" type="number" min="0" max="3" required style="width: 100px;"></label>
        <label>Explanation: <textarea id="createExplanation" rows="3" style="width: 98%; min-width: 350px; min-height: 50px;"></textarea></label>
        <label>Video: <input id="createVideo" style="width: 220px;"></label>
        <label>Video URL: <input id="createVideoUrl" style="width: 220px;"></label>
        <label>Video Start (seconds): <input id="createVideoStart" type="number" min="0" style="width: 120px;"></label>
        <label>Type<span class="required-star">*</span>: 
          <select id="createType" required style="width: 120px;" onchange="updateMockFieldsRequired()">
            <option value="mock">Mock</option>
            <option value="practice">Practice</option>
          </select>
        </label>
        <div class="modal-actions">
          <button type="submit" class="save" id="createSubmitBtn"><span id="createSpinner" style="display:none;"><i class='fas fa-spinner fa-spin'></i></span> <i class="fas fa-plus"></i> Create</button>
          <button type="button" class="cancel" onclick="closeCreateModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    // Set your backend API base URL here
    // const API_BASE = 'http://localhost:5050/api/admin'; // For local testing
    const API_BASE = 'https://examprep-backend.onrender.com/api/admin'; // For production

    function isTokenExpired(token) {
      if (!token) return true;
      try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        if (!payload.exp) return false; // No exp field, assume not expired
        const now = Math.floor(Date.now() / 1000);
        return payload.exp < now;
      } catch (e) {
        return true; // Invalid token format
      }
    }
    async function fetchQuestions() {
      let ADMIN_TOKEN = localStorage.getItem('adminToken') || '';
      if (!ADMIN_TOKEN || isTokenExpired(ADMIN_TOKEN)) {
        ADMIN_TOKEN = prompt('Enter your admin JWT token:');
        if (!ADMIN_TOKEN) {
          showAdminMsg('No token provided. Please enter a valid admin token.', true);
          return;
        }
        localStorage.setItem('adminToken', ADMIN_TOKEN);
      }
      
      const exam = document.getElementById('exam').value;
      const day = document.getElementById('day').value;
      const type = document.getElementById('type').value;
      
      let url = `${API_BASE}/questions?exam=${encodeURIComponent(exam)}&day=${encodeURIComponent(day)}`;
      if (type) url += `&type=${encodeURIComponent(type)}`;
      
      try {
        showAdminMsg('Fetching questions...', false);
        const res = await fetch(url, {
          headers: { Authorization: 'Bearer ' + ADMIN_TOKEN }
        });
        
        if (res.status === 401) {
          showAdminMsg('Session expired or unauthorized. Please log in again.', true);
          localStorage.removeItem('adminToken');
          return;
        }
        
        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          showAdminMsg(`Failed to fetch questions: ${errorData.message || res.statusText}`, true);
          return;
        }
        
        const questions = await res.json();
        renderQuestions(questions);
        showAdminMsg(`Successfully fetched ${questions.length} questions.`);
      } catch (e) {
        console.error('Fetch error:', e);
        showAdminMsg('Failed to fetch questions. Please check your connection and try again.', true);
      }
    }

    function renderQuestions(questions) {
      const tbody = document.querySelector('#questionsTable tbody');
      tbody.innerHTML = '';
      
      if (!questions || questions.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 2rem; color: #6b7280;">
              <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
              No questions found for the selected criteria.
            </td>
          </tr>
        `;
        return;
      }
      
      questions.forEach(q => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${q.id || q._id}</td>
          <td>${q.question}</td>
          <td>${q.section || ''}</td>
          <td>${q.type || ''}</td>
          <td class="actions">
            <button class="action-btn" title="Edit" onclick="window._editQuestionObj = ${JSON.stringify(q).replace(/"/g, '&quot;')}; showEditModal()"><i class="fas fa-edit"></i></button>
            <button class="action-btn delete" title="Delete" onclick="deleteQuestion('${q._id}')"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    window.showEditModal = function(id, question, section, type) {
      // Fetch the full question object from the table row or API if needed
      const q = window._editQuestionObj || {};
      document.getElementById('editId').value = q.id || '';
      document.getElementById('editExam').value = q.exam || '';
      document.getElementById('editDay').value = q.day || '';
      document.getElementById('editSection').value = q.section || '';
      document.getElementById('editImg').value = q.img || '';
      document.getElementById('editPassage').value = q.passage || '';
      document.getElementById('editQuestion').value = q.question || '';
      (q.options || []).forEach((opt, i) => {
        if (i < 4) document.getElementById('editOption'+i).value = opt;
      });
      for (let i = (q.options||[]).length; i < 4; i++) document.getElementById('editOption'+i).value = '';
      document.getElementById('editAnswerIndex').value = q.answerIndex ?? '';
      document.getElementById('editExplanation').value = q.explanation || '';
      document.getElementById('editVideo').value = q.video || '';
      document.getElementById('editVideoUrl').value = q.videoUrl || '';
      document.getElementById('editVideoStart').value = q.videoStart ?? '';
      document.getElementById('editType').value = q.type || 'mock';
      updateEditMockFieldsRequired();
      document.getElementById('editModalBg').style.display = 'flex';
    }

    window.closeEditModal = function() {
      document.getElementById('editModalBg').style.display = 'none';
    }

    document.getElementById('editForm').onsubmit = async function(e) {
      e.preventDefault();
      let ADMIN_TOKEN = localStorage.getItem('adminToken') || '';
      if (!ADMIN_TOKEN || isTokenExpired(ADMIN_TOKEN)) {
        ADMIN_TOKEN = prompt('Enter your admin JWT token:');
        localStorage.setItem('adminToken', ADMIN_TOKEN);
      }
      const btn = document.getElementById('editSubmitBtn');
      const spinner = document.getElementById('editSpinner');
      btn.disabled = true; spinner.style.display = '';
      const exam = document.getElementById('editExam').value.trim();
      const day = document.getElementById('editDay').value;
      const section = document.getElementById('editSection').value.trim();
      const id = document.getElementById('editId').value.trim();
      const img = document.getElementById('editImg').value.trim() || null;
      const passage = document.getElementById('editPassage').value.trim() || null;
      const question = document.getElementById('editQuestion').value.trim();
      const options = [
        document.getElementById('editOption0').value.trim(),
        document.getElementById('editOption1').value.trim(),
        document.getElementById('editOption2').value.trim(),
        document.getElementById('editOption3').value.trim()
      ];
      const answerIndex = Number(document.getElementById('editAnswerIndex').value);
      const explanation = document.getElementById('editExplanation').value.trim();
      const video = document.getElementById('editVideo').value.trim();
      const videoUrl = document.getElementById('editVideoUrl').value.trim();
      const videoStart = document.getElementById('editVideoStart').value ? Number(document.getElementById('editVideoStart').value) : undefined;
      const type = document.getElementById('editType').value;
      // Validation
      if (!exam || !id || !question || !type) {
        showAdminMsg('Please fill all required fields.', true); btn.disabled = false; spinner.style.display = 'none'; return;
      }
      if (type === 'mock' && (day === '' || section === '')) {
        showAdminMsg('Day and Section are required for mock questions.', true); btn.disabled = false; spinner.style.display = 'none'; return;
      }
      if (options.some(opt => !opt)) {
        showAdminMsg('All options must be filled.', true); btn.disabled = false; spinner.style.display = 'none'; return;
      }
      if (answerIndex < 0 || answerIndex >= options.length || isNaN(answerIndex)) {
        showAdminMsg('Answer Index must be between 0 and 3.', true); btn.disabled = false; spinner.style.display = 'none'; return;
      }
      try {
        // Use MongoDB _id for the API call, not the custom id field
        const mongoId = window._editQuestionObj._id;
        const res = await fetch(`${API_BASE}/questions/${mongoId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            Authorization: 'Bearer ' + ADMIN_TOKEN
          },
          body: JSON.stringify({ exam, day, section, id, img, passage, question, options, answerIndex, explanation, video, videoUrl, videoStart, type })
        });
        if (!res.ok) {
          let msg = 'Failed to update question.';
          try {
            const err = await res.json();
            msg += ' ' + (err.message || JSON.stringify(err));
          } catch {}
          showAdminMsg(msg, true);
          btn.disabled = false; spinner.style.display = 'none';
          return;
        }
        closeEditModal();
        fetchQuestions();
        showAdminMsg('Question updated successfully!');
      } catch (e) {
        showAdminMsg('Failed to update question. ' + e.message, true);
      }
      btn.disabled = false; spinner.style.display = 'none';
    };

    window.deleteQuestion = async function(id) {
      let ADMIN_TOKEN = localStorage.getItem('adminToken') || '';
      if (!ADMIN_TOKEN || isTokenExpired(ADMIN_TOKEN)) {
        ADMIN_TOKEN = prompt('Enter your admin JWT token:');
        if (!ADMIN_TOKEN) {
          showAdminMsg('No token provided. Please enter a valid admin token.', true);
          return;
        }
        localStorage.setItem('adminToken', ADMIN_TOKEN);
      }
      
      if (!confirm('Are you sure you want to delete this question?')) return;
      
      try {
        showAdminMsg('Deleting question...', false);
        const res = await fetch(`${API_BASE}/questions/${id}`, {
          method: 'DELETE',
          headers: { Authorization: 'Bearer ' + ADMIN_TOKEN }
        });
        
        if (res.status === 401) {
          showAdminMsg('Session expired or unauthorized. Please log in again.', true);
          localStorage.removeItem('adminToken');
          return;
        }
        
        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          showAdminMsg(`Failed to delete question: ${errorData.message || res.statusText}`, true);
          return;
        }
        
        showAdminMsg('Question deleted successfully!');
        fetchQuestions();
      } catch (e) {
        console.error('Delete error:', e);
        showAdminMsg('Failed to delete question. Please check your connection and try again.', true);
      }
    }

    window.showCreateModal = function() {
      document.getElementById('createExam').value = '';
      document.getElementById('createDay').value = '';
      document.getElementById('createSection').value = '';
      document.getElementById('createId').value = '';
      document.getElementById('createImg').value = '';
      document.getElementById('createPassage').value = '';
      document.getElementById('createQuestion').value = '';
      document.getElementById('createOption0').value = '';
      document.getElementById('createOption1').value = '';
      document.getElementById('createOption2').value = '';
      document.getElementById('createOption3').value = '';
      document.getElementById('createAnswerIndex').value = '';
      document.getElementById('createExplanation').value = '';
      document.getElementById('createVideo').value = '';
      document.getElementById('createVideoUrl').value = '';
      document.getElementById('createVideoStart').value = '';
      document.getElementById('createType').value = 'mock';
      document.getElementById('createModalBg').style.display = 'flex';
    }
    window.closeCreateModal = function() {
      document.getElementById('createModalBg').style.display = 'none';
    }
    function showAdminMsg(msg, isError = false) {
      const el = document.getElementById('adminMsg');
      el.textContent = msg;
      el.style.color = isError ? '#e11d48' : '#059669';
      el.style.background = isError ? '#fef2f2' : '#f0fdf4';
      el.style.borderRadius = '6px';
      el.style.padding = '0.4em 1em';
      el.style.transition = 'all 0.2s';
      if (msg) setTimeout(() => { el.textContent = ''; el.style.background = 'none'; }, 4000);
    }
    document.getElementById('createForm').onsubmit = async function(e) {
      e.preventDefault();
      const btn = document.getElementById('createSubmitBtn');
      const spinner = document.getElementById('createSpinner');
      btn.disabled = true; spinner.style.display = '';
      let ADMIN_TOKEN = localStorage.getItem('adminToken') || '';
      if (!ADMIN_TOKEN || isTokenExpired(ADMIN_TOKEN)) {
        ADMIN_TOKEN = prompt('Enter your admin JWT token:');
        localStorage.setItem('adminToken', ADMIN_TOKEN);
      }
      
      // Get form values
      const exam = document.getElementById('createExam').value.trim();
      const day = document.getElementById('createDay').value;
      const section = document.getElementById('createSection').value.trim();
      const id = document.getElementById('createId').value.trim();
      const img = document.getElementById('createImg').value.trim() || null;
      const passage = document.getElementById('createPassage').value.trim() || null;
      const question = document.getElementById('createQuestion').value.trim();
      const options = [
        document.getElementById('createOption0').value.trim(),
        document.getElementById('createOption1').value.trim(),
        document.getElementById('createOption2').value.trim(),
        document.getElementById('createOption3').value.trim()
      ];
      const answerIndex = Number(document.getElementById('createAnswerIndex').value);
      const explanation = document.getElementById('createExplanation').value.trim();
      const video = document.getElementById('createVideo').value.trim();
      const videoUrl = document.getElementById('createVideoUrl').value.trim();
      const videoStart = document.getElementById('createVideoStart').value ? Number(document.getElementById('createVideoStart').value) : undefined;
      const type = document.getElementById('createType').value;
      
      // Client-side validation
      if (!exam || !id || !question || !type) {
        showAdminMsg('Please fill all required fields.', true); 
        btn.disabled = false; 
        spinner.style.display = 'none'; 
        return;
      }
      if (type === 'mock' && (day === '' || section === '')) {
        showAdminMsg('Day and Section are required for mock questions.', true); 
        btn.disabled = false; 
        spinner.style.display = 'none'; 
        return;
      }
      if (options.some(opt => !opt)) {
        showAdminMsg('All options must be filled.', true); 
        btn.disabled = false; 
        spinner.style.display = 'none'; 
        return;
      }
      if (answerIndex < 0 || answerIndex >= options.length || isNaN(answerIndex)) {
        showAdminMsg('Answer Index must be between 0 and 3.', true); 
        btn.disabled = false; 
        spinner.style.display = 'none'; 
        return;
      }
      try {
        const res = await fetch(`${API_BASE}/questions`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: 'Bearer ' + ADMIN_TOKEN
          },
          body: JSON.stringify({ exam, day, section, id, img, passage, question, options, answerIndex, explanation, video, videoUrl, videoStart, type })
        });
        if (!res.ok) {
          const err = await res.json();
          showAdminMsg('Error: ' + (err.message || 'Submission failed.'), true);
        } else {
          showAdminMsg('Question created successfully!');
          closeCreateModal();
          fetchQuestions();
        }
      } catch (e) {
        showAdminMsg('Network or server error.', true);
      }
      btn.disabled = false; spinner.style.display = 'none';
    };
    window.handleCSVSelected = function(event) {
      const file = event.target.files[0];
      if (!file) return;
      const previewDiv = document.getElementById('csvPreviewContainer');
      const confirmDiv = document.getElementById('csvConfirmContainer');
      previewDiv.innerHTML = '<b>Parsing CSV...</b>';
      confirmDiv.innerHTML = '';
      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          const data = results.data;
          const errors = results.errors;
          if (errors && errors.length) {
            previewDiv.innerHTML = '<span style="color:#e11d48">CSV Parse Error: ' + errors[0].message + '</span>';
            confirmDiv.innerHTML = '';
            return;
          }
          if (!data.length) {
            previewDiv.innerHTML = '<span style="color:#e11d48">No rows found in CSV.</span>';
            confirmDiv.innerHTML = '';
            return;
          }
          // Required fields
          const requiredAll = ['id','question','option1','option2','answerIndex','type','topics','level'];
          const requiredMock = ['mock_code','day','section'];
          let missingRows = [];
          let invalidRows = [];
          const rowCount = data.length;
          data.forEach((row, i) => {
            let missing = [];
            requiredAll.forEach(col => { if (!row[col]) missing.push(col); });
            if ((row.type||'').toLowerCase() === 'mock') {
              requiredMock.forEach(col => { if (!row[col]) missing.push(col); });
            }
            // At least two options
            const options = [row.option1, row.option2, row.option3, row.option4].filter(Boolean);
            if (options.length < 2) missing.push('At least two options (option1, option2)');
            // answerIndex valid
            const answerIndex = parseInt(row.answerIndex, 10);
            if (isNaN(answerIndex) || answerIndex < 0 || answerIndex >= options.length) missing.push('Valid answerIndex (0-based)');
            if (missing.length) missingRows.push({row: i+1, fields: missing});
          });
          if (missingRows.length) {
            let html = `<div style='color:#e11d48;font-weight:500;'>Missing/invalid required fields in CSV (${missingRows.length} of ${rowCount} row${rowCount>1?'s':''}):</div><ul style='color:#e11d48;margin:0.5em 0 0 1.2em;'>`;
            missingRows.slice(0,10).forEach(r => {
              html += `<li>Row ${r.row}: <b>${r.fields.join(', ')}</b></li>`;
            });
            if (missingRows.length > 10) html += `<li>...and ${missingRows.length-10} more rows</li>`;
            html += '</ul>';
            previewDiv.innerHTML = html;
            confirmDiv.innerHTML = '';
          } else {
            previewDiv.innerHTML = `<div style='color:#059669;font-weight:500;'>All required fields present and valid in all ${rowCount} row${rowCount>1?'s':''}.</div>`;
            confirmDiv.innerHTML = `<button id='csvConfirmBtn' class='upload-btn' style='margin-top:0.7em;'><i class='fas fa-check'></i> Confirm & Upload</button>`;
            document.getElementById('csvConfirmBtn').onclick = function() {
              // Build payload as array of question objects
              const questions = data.map(row => ({
                id: row.id.trim(),
                day: row.day ? Number(row.day) : undefined,
                question: row.question.trim(),
                section: row.section ? row.section.trim() : '',
                options: [row.option1, row.option2, row.option3, row.option4].filter(Boolean),
                answerIndex: parseInt(row.answerIndex, 10),
                explanation: row.explanation ? row.explanation.trim() : '',
                exam: row.exam ? row.exam.trim() : '',
                topics: row.topics ? row.topics.split(',').map(t => t.trim()) : [],
                type: row.type.trim(),
                level: row.level ? row.level.trim() : '',
                difficulty: row.difficulty ? row.difficulty.trim() : '',
                mock_code: row.mock_code ? row.mock_code.trim() : '',
                img: row.img ? row.img.trim() : '',
                passage: row.passage ? row.passage.trim() : '',
                video: row.video ? row.video.trim() : '',
                videoUrl: row.videoUrl ? row.videoUrl.trim() : '',
                videoStart: row.videoStart ? row.videoStart.trim() : ''
              }));
              uploadQuestionsBulk(questions);
            };
          }
        }
      });
      document.getElementById('csvFileInput').value = '';
    }
    async function uploadCSVFile(file) {
      let ADMIN_TOKEN = localStorage.getItem('adminToken') || '';
      if (!ADMIN_TOKEN || isTokenExpired(ADMIN_TOKEN)) {
        ADMIN_TOKEN = prompt('Enter your admin JWT token:');
        localStorage.setItem('adminToken', ADMIN_TOKEN);
      }
      const formData = new FormData();
      formData.append('file', file);
      showAdminMsg('Uploading CSV...');
      const res = await fetch(`${API_BASE}/questions/upload-csv`, {
        method: 'POST',
        headers: { Authorization: 'Bearer ' + ADMIN_TOKEN },
        body: formData
      });
      if (res.ok) {
        showAdminMsg('CSV uploaded successfully!');
        fetchQuestions();
      } else {
        const err = await res.json().catch(() => ({}));
        showAdminMsg('CSV upload failed: ' + (err.message || 'Invalid file or schema.'), true);
      }
      document.getElementById('csvPreviewContainer').innerHTML = '';
      document.getElementById('csvConfirmContainer').innerHTML = '';
    }

    // New bulk upload function for JSON array of questions
    async function uploadQuestionsBulk(questions) {
      let ADMIN_TOKEN = localStorage.getItem('adminToken') || '';
      if (!ADMIN_TOKEN || isTokenExpired(ADMIN_TOKEN)) {
        ADMIN_TOKEN = prompt('Enter your admin JWT token:');
        localStorage.setItem('adminToken', ADMIN_TOKEN);
      }
      showAdminMsg('Uploading questions...');
      try {
        const res = await fetch(`${API_BASE}/questions/upload-csv`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: 'Bearer ' + ADMIN_TOKEN
          },
          body: JSON.stringify({ questions })
        });
        if (res.ok) {
          showAdminMsg('Questions uploaded successfully!');
          fetchQuestions();
        } else {
          const err = await res.json().catch(() => ({}));
          showAdminMsg('Upload failed: ' + (err.message || 'Invalid data.'), true);
        }
      } catch (e) {
        showAdminMsg('Network or server error.', true);
      }
      document.getElementById('csvPreviewContainer').innerHTML = '';
      document.getElementById('csvConfirmContainer').innerHTML = '';
    }

    window.downloadQuestionsCSV = async function() {
      let ADMIN_TOKEN = localStorage.getItem('adminToken') || '';
      if (!ADMIN_TOKEN || isTokenExpired(ADMIN_TOKEN)) {
        ADMIN_TOKEN = prompt('Enter your admin JWT token:');
        localStorage.setItem('adminToken', ADMIN_TOKEN);
      }
      try {
        const exam = document.getElementById('exam').value;
        const day = document.getElementById('day').value;
        let url = `${API_BASE}/questions?exam=${encodeURIComponent(exam)}&day=${encodeURIComponent(day)}`;
        const res = await fetch(url, { headers: { Authorization: 'Bearer ' + ADMIN_TOKEN } });
        const questions = await res.json();
        if (!Array.isArray(questions) || !questions.length) {
          showAdminMsg('No questions to download.', true); return;
        }
        // CSV header
        const header = ['exam','day','section','id','img','passage','question','options','answerIndex','explanation','video','videoUrl','videoStart','type'];
        const csv = [header.join(',')].concat(
          questions.map(q => header.map(h => {
            let v = q[h];
            if (Array.isArray(v)) v = '"' + v.join('|') + '"';
            if (typeof v === 'string') v = '"' + v.replace(/"/g,'""') + '"';
            return v ?? '';
          }).join(','))
        ).join('\r\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'questions.csv';
        a.click();
      } catch (e) {
        showAdminMsg('Failed to download CSV.', true);
      }
    }
    function updateMockFieldsRequired() {
      const type = document.getElementById('createType').value;
      const dayInput = document.getElementById('createDay');
      const sectionInput = document.getElementById('createSection');
      const dayLabel = document.getElementById('labelCreateDay');
      const sectionLabel = document.getElementById('labelCreateSection');
      const starDay = document.getElementById('starCreateDay');
      const starSection = document.getElementById('starCreateSection');
      if (type === 'mock') {
        dayInput.required = true;
        sectionInput.required = true;
        starDay.style.display = '';
        starSection.style.display = '';
        dayLabel.style.opacity = 1;
        sectionLabel.style.opacity = 1;
      } else {
        dayInput.required = false;
        sectionInput.required = false;
        starDay.style.display = 'none';
        starSection.style.display = 'none';
        dayLabel.style.opacity = 0.7;
        sectionLabel.style.opacity = 0.7;
      }
    }
    document.getElementById('createType').addEventListener('change', updateMockFieldsRequired);
    updateMockFieldsRequired();
    function updateEditMockFieldsRequired() {
      const type = document.getElementById('editType').value;
      const dayInput = document.getElementById('editDay');
      const sectionInput = document.getElementById('editSection');
      const dayLabel = document.getElementById('labelEditDay');
      const sectionLabel = document.getElementById('labelEditSection');
      const starDay = document.getElementById('starEditDay');
      const starSection = document.getElementById('starEditSection');
      if (type === 'mock') {
        dayInput.required = true;
        sectionInput.required = true;
        starDay.style.display = '';
        starSection.style.display = '';
        dayLabel.style.opacity = 1;
        sectionLabel.style.opacity = 1;
      } else {
        dayInput.required = false;
        sectionInput.required = false;
        starDay.style.display = 'none';
        starSection.style.display = 'none';
        dayLabel.style.opacity = 0.7;
        sectionLabel.style.opacity = 0.7;
      }
    }
    document.getElementById('editType').addEventListener('change', updateEditMockFieldsRequired);
    updateEditMockFieldsRequired();
    window.downloadTemplateCSV = function() {
      const header = [
        'id','day','question','section','option1','option2','option3','option4','answerIndex','explanation','exam','topics','type','level','difficulty','mock_code','img','passage','video','videoUrl','videoStart'
      ];
      const exampleMock = [
        'M1','1','What is the square root of 16?','QA','4','8','16','2','0','The square root of 16 is 4.','CAT','Arithmetic','mock','easy','easy','Mock1','','','','',''
      ];
      const examplePractice = [
        'P1','','Who discovered gravity?','VARC','Newton','Einstein','','','0','Newton discovered gravity.','CAT','Physics','practice','medium','medium','','','','',''
      ];
      const csv = [header.join(','), exampleMock.join(','), examplePractice.join(',')].join('\r\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'sample_questions_template.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Initial fetch
    fetchQuestions();

    // Logout function
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('adminToken');
        window.location.href = '../login.html';
      }
    }
  </script>
</body>
</html> 