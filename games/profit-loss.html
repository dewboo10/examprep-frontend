<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>ðŸ’° Profit & Loss Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .formula-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: popIn 0.3s ease;
            max-width: 90%;
            width: 400px;
        }
        
        .formula-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            animation: fadeIn 0.3s ease;
        }
        
        .option-btn {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: left;
            padding: 12px 20px;
            line-height: 1.4;
            min-height: 60px;
            display: flex;
            align-items: center;
        }
        
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .correct-answer {
            animation: pulse 0.6s ease;
            background-color: #10b981 !important;
            color: white !important;
        }
        
        .wrong-answer {
            animation: shake 0.5s ease;
            background-color: #ef4444 !important;
            color: white !important;
        }
        
        .hint-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #f59e0b;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: bounce 1s infinite;
        }
        
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-8px); }
            80% { transform: translateX(8px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .streak-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f59e0b;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            animation: pulse 1s infinite;
        }
        
        .formula-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .formula-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <div class="card p-6 relative">
            <!-- Header -->
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                    ðŸ’° Profit & Loss Challenge
                </h1>
                <p class="text-gray-600 mt-2">Test your understanding of business calculations!</p>
            </header>
            
            <!-- Level selection -->
            <div id="levelScreen" class="text-center">
                <h2 class="text-2xl font-bold mb-6 text-blue-600">Select Difficulty Level</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="level-card p-6 rounded-2xl text-center bg-green-50 border-2 border-green-500 cursor-pointer" data-level="easy">
                        <div class="text-5xl mb-4">ðŸŒ±</div>
                        <h3 class="font-bold text-xl mb-2">Beginner</h3>
                        <p class="text-gray-600 mb-3">Basic calculations</p>
                        <div class="text-sm text-gray-700">20 questions</div>
                    </div>
                    
                    <div class="level-card p-6 rounded-2xl text-center bg-yellow-50 border-2 border-yellow-500 cursor-pointer" data-level="medium">
                        <div class="text-5xl mb-4">ðŸŒ¿</div>
                        <h3 class="font-bold text-xl mb-2">Intermediate</h3>
                        <p class="text-gray-600 mb-3">Complex scenarios</p>
                        <div class="text-sm text-gray-700">20 questions</div>
                    </div>
                    
                    <div class="level-card p-6 rounded-2xl text-center bg-red-50 border-2 border-red-500 cursor-pointer" data-level="hard">
                        <div class="text-5xl mb-4">ðŸ”¥</div>
                        <h3 class="font-bold text-xl mb-2">Advanced</h3>
                        <p class="text-gray-600 mb-3">Expert challenges</p>
                        <div class="text-sm text-gray-700">20 questions</div>
                    </div>
                </div>
            </div>
            
            <!-- Game screen -->
            <div id="gameScreen" class="hidden">
                <!-- Game stats -->
                <div class="flex justify-between items-center mb-6">
                    <div class="text-left">
                        <div class="text-sm text-gray-600">Time Left</div>
                        <div class="text-xl font-bold" id="timer">180s</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-600">Score</div>
                        <div class="text-xl font-bold" id="score">0</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-600">Best Score</div>
                        <div class="text-xl font-bold" id="bestScore">0</div>
                    </div>
                </div>
                
                <!-- Question area -->
                <div class="text-center mb-6">
                    <p class="text-gray-700 text-lg" id="questionText">Loading question...</p>
                </div>
                
                <!-- Options area -->
                <div class="space-y-3 mb-6" id="options"></div>
                
                <!-- Feedback area -->
                <div id="feedback" class="text-center min-h-[24px] mb-4"></div>
                
                <!-- Retry button -->
                <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-medium hidden transition transform hover:scale-105" id="retryBtn">
                    Play Again
                </button>
                
                <!-- Streak indicator -->
                <div id="streakIndicator" class="streak-indicator hidden">
                    <i class="fas fa-fire mr-1"></i> <span id="streakCount">0</span> streak!
                </div>
            </div>
        </div>
    </div>

    <script>
        const gameData = {
            levels: {
                easy: {
                    name: "Beginner",
                    icon: "ðŸŒ±",
                    questions: [
                        {
                            question: "A shopkeeper buys a shirt for â‚¹500 and sells it for â‚¹600. What is his profit?",
                            options: ["â‚¹100", "â‚¹200", "â‚¹50", "â‚¹150"],
                            answer: "â‚¹100",
                            formula: "Profit = Selling Price - Cost Price",
                            explanation: "Profit = â‚¹600 - â‚¹500 = â‚¹100"
                        },
                        {
                            question: "If a book costs â‚¹200 and is sold at a loss of â‚¹40, what is the selling price?",
                            options: ["â‚¹160", "â‚¹180", "â‚¹140", "â‚¹150"],
                            answer: "â‚¹160",
                            formula: "Selling Price = Cost Price - Loss",
                            explanation: "Selling Price = â‚¹200 - â‚¹40 = â‚¹160"
                        },
                        {
                            question: "A toy is sold for â‚¹450 with a profit of â‚¹50. What was its cost price?",
                            options: ["â‚¹400", "â‚¹350", "â‚¹450", "â‚¹500"],
                            answer: "â‚¹400",
                            formula: "Cost Price = Selling Price - Profit",
                            explanation: "Cost Price = â‚¹450 - â‚¹50 = â‚¹400"
                        },
                        {
                            question: "If a product is sold at â‚¹800 with a loss of â‚¹100, what was its cost price?",
                            options: ["â‚¹900", "â‚¹850", "â‚¹950", "â‚¹1000"],
                            answer: "â‚¹900",
                            formula: "Cost Price = Selling Price + Loss",
                            explanation: "Cost Price = â‚¹800 + â‚¹100 = â‚¹900"
                        },
                        {
                            question: "A shopkeeper makes a profit of â‚¹75 on a â‚¹300 item. What is the selling price?",
                            options: ["â‚¹375", "â‚¹350", "â‚¹400", "â‚¹425"],
                            answer: "â‚¹375",
                            formula: "Selling Price = Cost Price + Profit",
                            explanation: "Selling Price = â‚¹300 + â‚¹75 = â‚¹375"
                        },
                        {
                            question: "If an item is sold at â‚¹250 with a profit of â‚¹50, what was its cost price?",
                            options: ["â‚¹200", "â‚¹180", "â‚¹220", "â‚¹240"],
                            answer: "â‚¹200",
                            formula: "Cost Price = Selling Price - Profit",
                            explanation: "Cost Price = â‚¹250 - â‚¹50 = â‚¹200"
                        },
                        {
                            question: "A product is sold at â‚¹600 with a loss of â‚¹100. What was its cost price?",
                            options: ["â‚¹700", "â‚¹650", "â‚¹750", "â‚¹800"],
                            answer: "â‚¹700",
                            formula: "Cost Price = Selling Price + Loss",
                            explanation: "Cost Price = â‚¹600 + â‚¹100 = â‚¹700"
                        },
                        {
                            question: "If a shopkeeper makes a profit of â‚¹120 on a â‚¹480 item, what is the selling price?",
                            options: ["â‚¹600", "â‚¹580", "â‚¹620", "â‚¹640"],
                            answer: "â‚¹600",
                            formula: "Selling Price = Cost Price + Profit",
                            explanation: "Selling Price = â‚¹480 + â‚¹120 = â‚¹600"
                        },
                        {
                            question: "A book is sold at â‚¹350 with a loss of â‚¹50. What was its cost price?",
                            options: ["â‚¹400", "â‚¹380", "â‚¹420", "â‚¹450"],
                            answer: "â‚¹400",
                            formula: "Cost Price = Selling Price + Loss",
                            explanation: "Cost Price = â‚¹350 + â‚¹50 = â‚¹400"
                        },
                        {
                            question: "If an item costs â‚¹450 and is sold at a profit of â‚¹50, what is the selling price?",
                            options: ["â‚¹500", "â‚¹480", "â‚¹520", "â‚¹550"],
                            answer: "â‚¹500",
                            formula: "Selling Price = Cost Price + Profit",
                            explanation: "Selling Price = â‚¹450 + â‚¹50 = â‚¹500"
                        }
                    ]
                },
                medium: {
                    name: "Intermediate",
                    icon: "ðŸŒ¿",
                    questions: [
                        {
                            question: "A shopkeeper buys 20 shirts at â‚¹300 each and sells them at â‚¹350 each. What is his total profit?",
                            options: ["â‚¹1000", "â‚¹800", "â‚¹1200", "â‚¹1500"],
                            answer: "â‚¹1000",
                            formula: "Total Profit = (Selling Price - Cost Price) Ã— Quantity",
                            explanation: "Profit per shirt = â‚¹350 - â‚¹300 = â‚¹50\nTotal Profit = â‚¹50 Ã— 20 = â‚¹1000"
                        },
                        {
                            question: "If a shopkeeper makes a 15% profit on an item costing â‚¹400, what is the selling price?",
                            options: ["â‚¹460", "â‚¹450", "â‚¹470", "â‚¹480"],
                            answer: "â‚¹460",
                            formula: "Selling Price = Cost Price + (Cost Price Ã— Profit Percentage)",
                            explanation: "Profit = â‚¹400 Ã— 15% = â‚¹60\nSelling Price = â‚¹400 + â‚¹60 = â‚¹460"
                        },
                        {
                            question: "A product is sold at a 20% loss. If the cost price was â‚¹500, what is the selling price?",
                            options: ["â‚¹400", "â‚¹450", "â‚¹350", "â‚¹380"],
                            answer: "â‚¹400",
                            formula: "Selling Price = Cost Price - (Cost Price Ã— Loss Percentage)",
                            explanation: "Loss = â‚¹500 Ã— 20% = â‚¹100\nSelling Price = â‚¹500 - â‚¹100 = â‚¹400"
                        },
                        {
                            question: "If a shopkeeper wants to make a 25% profit on an item costing â‚¹800, what should be the selling price?",
                            options: ["â‚¹1000", "â‚¹950", "â‚¹1050", "â‚¹1100"],
                            answer: "â‚¹1000",
                            formula: "Selling Price = Cost Price + (Cost Price Ã— Profit Percentage)",
                            explanation: "Profit = â‚¹800 Ã— 25% = â‚¹200\nSelling Price = â‚¹800 + â‚¹200 = â‚¹1000"
                        },
                        {
                            question: "A shopkeeper sells 15 items at â‚¹200 each, making a total profit of â‚¹750. What was the cost price per item?",
                            options: ["â‚¹150", "â‚¹140", "â‚¹160", "â‚¹170"],
                            answer: "â‚¹150",
                            formula: "Cost Price = (Total Revenue - Total Profit) Ã· Quantity",
                            explanation: "Total Revenue = â‚¹200 Ã— 15 = â‚¹3000\nCost Price = (â‚¹3000 - â‚¹750) Ã· 15 = â‚¹150"
                        },
                        {
                            question: "If a product is sold at a 10% loss for â‚¹450, what was its cost price?",
                            options: ["â‚¹500", "â‚¹480", "â‚¹520", "â‚¹550"],
                            answer: "â‚¹500",
                            formula: "Cost Price = Selling Price Ã· (1 - Loss Percentage)",
                            explanation: "Cost Price = â‚¹450 Ã· (1 - 10%) = â‚¹450 Ã· 0.9 = â‚¹500"
                        },
                        {
                            question: "A shopkeeper wants to make a 30% profit on an item costing â‚¹600. What should be the selling price?",
                            options: ["â‚¹780", "â‚¹750", "â‚¹800", "â‚¹820"],
                            answer: "â‚¹780",
                            formula: "Selling Price = Cost Price + (Cost Price Ã— Profit Percentage)",
                            explanation: "Profit = â‚¹600 Ã— 30% = â‚¹180\nSelling Price = â‚¹600 + â‚¹180 = â‚¹780"
                        },
                        {
                            question: "If a product is sold at a 15% loss for â‚¹340, what was its cost price?",
                            options: ["â‚¹400", "â‚¹380", "â‚¹420", "â‚¹450"],
                            answer: "â‚¹400",
                            formula: "Cost Price = Selling Price Ã· (1 - Loss Percentage)",
                            explanation: "Cost Price = â‚¹340 Ã· (1 - 15%) = â‚¹340 Ã· 0.85 = â‚¹400"
                        },
                        {
                            question: "A shopkeeper buys 25 items at â‚¹120 each and sells them at â‚¹150 each. What is his total profit?",
                            options: ["â‚¹750", "â‚¹700", "â‚¹800", "â‚¹850"],
                            answer: "â‚¹750",
                            formula: "Total Profit = (Selling Price - Cost Price) Ã— Quantity",
                            explanation: "Profit per item = â‚¹150 - â‚¹120 = â‚¹30\nTotal Profit = â‚¹30 Ã— 25 = â‚¹750"
                        },
                        {
                            question: "If a shopkeeper makes a 20% profit on an item costing â‚¹500, what is the selling price?",
                            options: ["â‚¹600", "â‚¹580", "â‚¹620", "â‚¹640"],
                            answer: "â‚¹600",
                            formula: "Selling Price = Cost Price + (Cost Price Ã— Profit Percentage)",
                            explanation: "Profit = â‚¹500 Ã— 20% = â‚¹100\nSelling Price = â‚¹500 + â‚¹100 = â‚¹600"
                        }
                    ]
                },
                hard: {
                    name: "Advanced",
                    icon: "ðŸ”¥",
                    questions: [
                        {
                            question: "A shopkeeper marks an item 40% above cost price and gives a 20% discount. If the cost price is â‚¹500, what is the selling price?",
                            options: ["â‚¹560", "â‚¹540", "â‚¹580", "â‚¹600"],
                            answer: "â‚¹560",
                            formula: "Selling Price = Cost Price Ã— (1 + Markup) Ã— (1 - Discount)",
                            explanation: "Marked Price = â‚¹500 Ã— 1.4 = â‚¹700\nSelling Price = â‚¹700 Ã— 0.8 = â‚¹560"
                        },
                        {
                            question: "If a shopkeeper wants to make a 25% profit after giving a 15% discount on the marked price, what should be the markup percentage?",
                            options: ["47.06%", "45%", "50%", "52%"],
                            answer: "47.06%",
                            formula: "Markup = (1 + Desired Profit) Ã· (1 - Discount) - 1",
                            explanation: "Markup = (1 + 25%) Ã· (1 - 15%) - 1 = 1.25 Ã· 0.85 - 1 = 47.06%"
                        },
                        {
                            question: "A shopkeeper sells two items. First at 20% profit and second at 20% loss. If both cost â‚¹500 each, what is the overall profit/loss?",
                            options: ["No profit, no loss", "â‚¹50 profit", "â‚¹50 loss", "â‚¹100 loss"],
                            answer: "No profit, no loss",
                            formula: "Overall Result = (Profit on First + Loss on Second)",
                            explanation: "Profit on First = â‚¹500 Ã— 20% = â‚¹100\nLoss on Second = â‚¹500 Ã— 20% = â‚¹100\nOverall = â‚¹100 - â‚¹100 = â‚¹0"
                        },
                        {
                            question: "If a shopkeeper marks an item 50% above cost and gives a 25% discount, what is the profit percentage?",
                            options: ["12.5%", "15%", "10%", "20%"],
                            answer: "12.5%",
                            formula: "Profit % = ((1 + Markup) Ã— (1 - Discount) - 1) Ã— 100",
                            explanation: "Selling Price = 1.5 Ã— 0.75 = 1.125\nProfit % = (1.125 - 1) Ã— 100 = 12.5%"
                        },
                        {
                            question: "A shopkeeper buys 100 items at â‚¹80 each. He sells 60% at 20% profit and the rest at 10% loss. What is his overall profit/loss?",
                            options: ["â‚¹400 profit", "â‚¹300 profit", "â‚¹500 profit", "â‚¹200 profit"],
                            answer: "â‚¹400 profit",
                            formula: "Overall Result = (Quantity1 Ã— Profit1) + (Quantity2 Ã— Loss2)",
                            explanation: "Profit on 60 items = 60 Ã— (â‚¹80 Ã— 20%) = â‚¹960\nLoss on 40 items = 40 Ã— (â‚¹80 Ã— 10%) = â‚¹320\nOverall = â‚¹960 - â‚¹320 = â‚¹640"
                        },
                        {
                            question: "If a shopkeeper wants to make a 30% profit after giving a 20% discount, what should be the markup percentage?",
                            options: ["62.5%", "60%", "65%", "70%"],
                            answer: "62.5%",
                            formula: "Markup = (1 + Desired Profit) Ã· (1 - Discount) - 1",
                            explanation: "Markup = (1 + 30%) Ã· (1 - 20%) - 1 = 1.3 Ã· 0.8 - 1 = 62.5%"
                        },
                        {
                            question: "A shopkeeper marks an item 60% above cost and gives a 30% discount. If the cost price is â‚¹400, what is the selling price?",
                            options: ["â‚¹448", "â‚¹420", "â‚¹460", "â‚¹480"],
                            answer: "â‚¹448",
                            formula: "Selling Price = Cost Price Ã— (1 + Markup) Ã— (1 - Discount)",
                            explanation: "Marked Price = â‚¹400 Ã— 1.6 = â‚¹640\nSelling Price = â‚¹640 Ã— 0.7 = â‚¹448"
                        },
                        {
                            question: "If a shopkeeper sells three items at 15% profit, 10% loss, and 20% profit respectively, each costing â‚¹500, what is the overall profit/loss?",
                            options: ["â‚¹75 profit", "â‚¹50 profit", "â‚¹100 profit", "â‚¹25 profit"],
                            answer: "â‚¹75 profit",
                            formula: "Overall Result = Sum of individual profits/losses",
                            explanation: "Profit1 = â‚¹500 Ã— 15% = â‚¹75\nLoss2 = â‚¹500 Ã— 10% = â‚¹50\nProfit3 = â‚¹500 Ã— 20% = â‚¹100\nOverall = â‚¹75 - â‚¹50 + â‚¹100 = â‚¹125"
                        },
                        {
                            question: "A shopkeeper wants to make a 40% profit after giving a 25% discount. What should be the markup percentage?",
                            options: ["86.67%", "85%", "90%", "95%"],
                            answer: "86.67%",
                            formula: "Markup = (1 + Desired Profit) Ã· (1 - Discount) - 1",
                            explanation: "Markup = (1 + 40%) Ã· (1 - 25%) - 1 = 1.4 Ã· 0.75 - 1 = 86.67%"
                        },
                        {
                            question: "If a shopkeeper marks an item 70% above cost and gives a 35% discount, what is the profit percentage?",
                            options: ["10.5%", "12%", "9%", "15%"],
                            answer: "10.5%",
                            formula: "Profit % = ((1 + Markup) Ã— (1 - Discount) - 1) Ã— 100",
                            explanation: "Selling Price = 1.7 Ã— 0.65 = 1.105\nProfit % = (1.105 - 1) Ã— 100 = 10.5%"
                        }
                    ]
                }
            },
            
            currentLevel: null,
            currentQuestion: 0,
            score: 0,
            lives: 3,
            correctAnswers: 0,
            startTime: null,
            currentStreak: 0,
            usedQuestions: new Set(),
            currentQuestionData: null
        };

        // DOM Elements
        const levelScreen = document.getElementById('levelScreen');
        const gameScreen = document.getElementById('gameScreen');
        const questionText = document.getElementById('questionText');
        const optionsEl = document.getElementById('options');
        const feedbackEl = document.getElementById('feedback');
        const scoreEl = document.getElementById('score');
        const bestScoreEl = document.getElementById('bestScore');
        const timerEl = document.getElementById('timer');
        const retryBtn = document.getElementById('retryBtn');
        const streakIndicator = document.getElementById('streakIndicator');
        const streakCount = document.getElementById('streakCount');

        // Initialize game
        function initGame() {
            // Add event listeners to level cards
            document.querySelectorAll('.level-card').forEach(card => {
                card.addEventListener('click', () => {
                    const level = card.dataset.level;
                    startLevel(level);
                });
            });
            
            // Load best score
            const savedBestScore = localStorage.getItem("profitLossBestScore") || "0";
            bestScoreEl.textContent = savedBestScore;
        }

        // Start a new level
        function startLevel(level) {
            gameData.currentLevel = level;
            gameData.currentQuestion = 0;
            gameData.score = 0;
            gameData.lives = 3;
            gameData.correctAnswers = 0;
            gameData.currentStreak = 0;
            gameData.usedQuestions.clear();
            
            // Hide streak indicator
            streakIndicator.classList.add('hidden');
            
            // Update UI
            levelScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            scoreEl.textContent = "0";
            timerEl.textContent = "180s";
            retryBtn.classList.add('hidden');
            
            // Start timer
            startTimer();
            
            // Load first question
            loadQuestion();
        }

        // Load a question
        function loadQuestion() {
            const level = gameData.levels[gameData.currentLevel];
            const question = getRandomQuestion(level);
            
            // Store current question for answer checking
            gameData.currentQuestionData = question;
            
            // Update question text
            questionText.textContent = question.question;
            
            // Clear previous content
            optionsEl.innerHTML = '';
            feedbackEl.innerHTML = '';
            
            // Shuffle options
            const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
            
            // Create options
            shuffledOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn w-full border text-left px-4 py-2 rounded-xl bg-white hover:bg-blue-50 transition';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(option, btn);
                optionsEl.appendChild(btn);
            });
            
            // Record start time
            gameData.startTime = new Date();
        }

        // Get random question
        function getRandomQuestion(level) {
            if (gameData.usedQuestions.size === level.questions.length) {
                gameData.usedQuestions.clear();
            }
            
            let availableQuestions = level.questions.filter((_, index) => !gameData.usedQuestions.has(index));
            let randomIndex = Math.floor(Math.random() * availableQuestions.length);
            let question = availableQuestions[randomIndex];
            
            gameData.usedQuestions.add(level.questions.indexOf(question));
            return question;
        }

        // Check answer
        function checkAnswer(selectedOption, btn) {
            // Disable all buttons
            Array.from(optionsEl.children).forEach(b => b.disabled = true);
            
            const isCorrect = selectedOption === gameData.currentQuestionData.answer;
            
            if (isCorrect) {
                gameData.score += 100;
                gameData.correctAnswers++;
                gameData.currentStreak++;
                
                // Add time bonus
                const timeTaken = (new Date() - gameData.startTime) / 1000;
                const timeBonus = Math.min(20, Math.floor(timeTaken / 10));
                gameData.score += timeBonus;
                
                // Show streak indicator
                if (gameData.currentStreak >= 3) {
                    streakCount.textContent = gameData.currentStreak;
                    streakIndicator.classList.remove('hidden');
                }
                
                btn.classList.add('correct-answer');
                feedbackEl.innerHTML = `
                    <div class="text-green-600 font-medium">
                        Correct! +${100 + timeBonus} points
                        ${gameData.currentStreak >= 3 ? ` (+${gameData.currentStreak * 10} streak bonus!)` : ''}
                    </div>
                `;
            } else {
                gameData.currentStreak = 0;
                streakIndicator.classList.add('hidden');
                btn.classList.add('wrong-answer');
                
                feedbackEl.innerHTML = `
                    <div class="text-red-600 font-medium">
                        Incorrect! The correct answer was: ${gameData.currentQuestionData.answer}
                    </div>
                `;
            }
            
            // Update score
            scoreEl.textContent = gameData.score;
            
            // Update best score
            const currentBest = parseInt(localStorage.getItem("profitLossBestScore") || "0");
            if (gameData.score > currentBest) {
                localStorage.setItem("profitLossBestScore", gameData.score);
                bestScoreEl.textContent = gameData.score;
            }
            
            // Move to next question
            setTimeout(() => {
                if (timeLeft > 0) {
                    loadQuestion();
                } else {
                    endGame();
                }
            }, 1500);
        }

        // Start timer
        function startTimer() {
            timeLeft = 180;
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.textContent = `${timeLeft}s`;
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        // End game
        function endGame() {
            clearInterval(timerInterval);
            gameScreen.classList.add('hidden');
            levelScreen.classList.remove('hidden');
            
            // Save score if logged in
            if (localStorage.getItem("isLoggedIn") === "true") {
                const userId = localStorage.getItem("userId");
                fetch("/api/brain-games/update-score", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        userId: userId,
                        gameId: "profit-loss",
                        score: gameData.score
                    })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        console.log("Score saved successfully");
                    }
                })
                .catch(err => console.error("Error saving score:", err));
            }
        }

        // Initialize the game
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1480010755078064"
     crossorigin="anonymous"></script>
    <script src="../js/main.js" defer></script>
</body>
</html>
